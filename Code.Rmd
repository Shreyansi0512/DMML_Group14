---
title: "EDA Code"
author: "Shreyansi Jain"
date: "2023-03-07"
output: html_document
---

```{r setup, include=FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries}
library(gmodels) # Cross Tables [CrossTable()]
library(ggmosaic) # Mosaic plot with ggplot [geom_mosaic()]
library(corrplot) # Correlation plot [corrplot()]
library(ggpubr) # Arranging ggplots together [ggarrange()]
library(cowplot) # Arranging ggplots together [plot_grid()]
library(caret) # ML [train(), confusionMatrix(), createDataPartition(), varImp(), trainControl()]
library(ROCR) # Model performance [performance(), prediction()]
library(plotROC) # ROC Curve with ggplot [geom_roc()]
library(pROC) # AUC computation [auc()]
library(PRROC) # AUPR computation [pr.curve()]
library(rpart) # Decision trees [rpart(), plotcp(), prune()]
library(rpart.plot) # Decision trees plotting [rpart.plot()]
library(ranger) # Optimized Random Forest [ranger()]
library(lightgbm) # Light GBM [lgb.train()]
library(xgboost) # XGBoost [xgb.DMatrix(), xgb.train()]
library(MLmetrics) # Custom metrics (F1 score for example)
library(tidyverse) # Data manipulation
library(doMC) # Parallel processing
```


```{r}
data = read.csv("group_14.csv")
data=replace(data,data=='',"missing")
head(data)
data %>% 
  summarise_all(list(~sum(. == "missing"))) %>% 
  gather(key = "variable", value = "no_missing") %>% 
  arrange(-no_missing)

#Defining crosstable to be used in our analysis
Crosstab = function(df, var1, var2){
  # df: dataframe containing both columns to cross
  # var1, var2: columns to cross together.
  CrossTable(df[, var1], df[, var2],
             prop.r = T,
             prop.c = F,
             prop.t = F,
             prop.chisq = F,
             dnn = c(var1, var2))
}

```
```{r}
#Treating missing values

#Default variable
table(data$default)

#As we can see from the table, only 1 individual replied with "yes", that they have credit in default. 
#78.5% individuals answered "no" and 21.5% did not reply at all. Hence, this variable is of not much significance as we get no information from it. Thus, we would remove this from our dataset.

data2=data %>%
  select(-default)

#Education 

Crosstab(data2,"education","y")
#Removing missing values from the data, since less than 5% of the data has missing values for this field and the proportion of the response variable for these values is the same as the data at a whole. It is better to omit these values altogether.

data2=data2%>%
  filter(education!="missing")

#Housing

Crosstab(data2,"housing","y")

chisq.test(data2$housing,data2$y)

#Since, the chi-square test for this variable has p-value less than 0.05 there is a significant association with the response variable. Hence, we would keep this in our dataset.

#Removing missing values from the data, since less than 5% of the data has missing values for this field and the proportion of the response variable for these values is the same as the data at a whole. It is better to omit these values altogether.

data2=data2%>%
  filter(housing!="missing")

#Loan

Crosstab(data2,"loan","y")
chisq.test(data2$loan,data2$y)

#Since, the chi-square test for this variable has p-value more than 0.05 there is no significant association with the response variable. Hence, we would exclude this from our dataset.

data2= data2 %>%
  select(-loan)

#Job
table(data2$job)

Crosstab(data2,"job","y")

#Removing missing values from the data, since less than 5% of the data has missing values for this field and the proportion of the response variable for these values is the same as the data at a whole. It is better to omit these values altogether.

data2=data2%>%
  filter(job!="missing")

#Marital status

Crosstab(data2,"marital","y")

#Removing missing values from the data, since less than 5% of the data has missing values for this field and the proportion of the response variable for these values is the same as the data at a whole. It is better to omit these values altogether.

data2=data2%>%
  filter(marital!="missing")
dim(data2)
dim(data)

data2 %>% 
  summarise_all(list(~sum(. == "missing"))) %>% 
  gather(key = "variable", value = "no_missing") %>% 
  arrange(-no_missing)

#No missing values left in our final dataset.
```

```{r}
#Train-test split.Using 80%/20% split.
set.seed(123)

n=nrow(data2)
ind=sample(c(1:n),0.8*n)
data.train=data2[ind,]
data.test=data2[-ind,]

dim(data.train)
dim(data.test)
```

```{r}
#EXPLORATORY DATA ANALYSIS

# Pdays : Number of days passed after client was last contacted by a previous campaign

# Distribution of data
table(data.train$pdays)

# The number 999 means that the client has not been contacted before, this constitutes as the majority of the clients. 
# This variable can be used to check if previous contact with a client is beneficial, but we need to convert this variable

data.train = data.train %>%
              mutate(n_contact = if_else(pdays == 999,0,1)) %>%
              select(-pdays)

Crosstab(data.train,'n_contact','y')

chisq.test(data.train$n_contact,data.train$y)
# It seems that when a client is contacted before,they are more receptive towards saying Yes
# This is verified with the chisq test as well.

# previous : Number of times a client has been contacted before this campaign
table(data.train$previous)

# This variable will provide the same information after encoding it to whether or not a previous contact has been made with the client or not.

# Poutcome : Outcome of the previous campaign on the respective client.


table(data.train$poutcome)

Crosstab(data.train,'poutcome','y')

```


```{r}
# Exploratory Data Analysis

# All Continuous variables

summary(data.train)

num_variables = c('age','emp.var.rate','cons.price.idx','cons.conf.idx','euribor3m','nr.employed')
library(GGally)

ggpairs(data.train,columns = num_variables)

corrplot(cor(data.train[num_variables]))

for (col in num_variables){
  
  plot = ggplot(data = data.train,aes(x = data.train[,col])) +
    geom_histogram()
  print(plot)
}
?aes

```









